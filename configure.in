# basics
AC_INIT(pyflag.in)

# Store the configuration in this header
AC_CONFIG_HEADER(src/include/config.h)
AC_CONFIG_AUX_DIR(config)
AM_INIT_AUTOMAKE(pyflag, 0.82)

# check standard stuff
AC_PROG_LIBTOOL
AC_PROG_CC

# check headers
AC_CHECK_HEADER(zlib.h,,AC_MSG_ERROR([You Must install zlib-dev to build pyflag]))
AC_CHECK_HEADER(pcap.h,,AC_MSG_ERROR([You Must install libpcap-dev to build pyflag]))
AC_CHECK_HEADER(magic.h,,AC_MSG_ERROR([You Must install libmagic-dev to build pyflag this may be part of file the package for some distros]))

## This doesnt work - why?
#AC_CHECK_LIB(extractor, EXTRACTOR_getKeywords,AC_MSG_WARN([If you install libextractor, you may find more metadata about your files - this is highly recommended, but optional. Under debian/ubuntu this requires libextractor-dev and python-ctypes]))

# python checks 
# (requires autoconf 1.5+ and the macros in acinclude.m4)
AM_PATH_PYTHON(2.4)
AC_PYTHON_DEVEL
AC_PYTHON_MODULE(MySQLdb, REQUIRED)
AC_PYTHON_MODULE(pexpect, REQUIRED)
AC_PYTHON_MODULE(PIL, REQUIRED)

# check for swig, custom macro in acinclude.m4
AC_PROG_SWIG(1.3)
SWIG_PYTHON

# check for stuff which uses pkg-config
PKG_CHECK_MODULES(libclamav, libclamav)

# check for binaries
AC_PATH_PROG([MYSQL], mysql)
AC_PATH_PROG([PLOTICUS], ploticus)
if test -z "$PLOTICUS"; then
	AC_MSG_WARN([You should install ploticus to get graphs])
	PLOTICUS=["\"echo You need to install ploticus to view graphs\""]
fi

# try to find magic files
AC_ARG_WITH(magic, AC_HELP_STRING([--with-magic], [specify a colon-separated list of system magic files, default autodetect]),,[magic=$(file -v | tail -1 | awk '{print $4}')])
AC_SUBST(magic)
            

# defines and output
AC_DEFINE([__DEBUG__], [], [Debuging enabled])

# Large file support
AC_SYS_LARGEFILE
AC_OUTPUT([ 
	Makefile 
	src/Makefile 
	src/lib/Makefile 
	src/mailtools/Makefile 
	src/mailtools/libpst-0.5/Makefile 
	src/indextools_ng/Makefile
	src/network/Makefile
	src/regtools/Makefile
	src/virustools/Makefile
	src/filesystems/Makefile
	src/filesystems/sleuthkit/Makefile
	src/filesystems/sleuthkit/auxtools/Makefile
	src/filesystems/sleuthkit/imgtools/Makefile
	src/filesystems/sleuthkit/fstools/Makefile
	src/filesystems/magic/Makefile
	src/include/Makefile
	debian/Makefile
	])
